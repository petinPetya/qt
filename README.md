# Яндекс лицей 2025, PyQT6

# Архитектура PyQt6 редактора изображений с базой данных и OCR

---

## Общее

- **Основной класс**: `PaintApp` (`QMainWindow`)
- **Модули**:
  - Графический интерфейс (Холст, инструменты)
  - Система авторизации (Login/Register)
  - Работа с изображениями (фильтры, каналы цветов)
  - Хранение работ в БД (orm SQLAlchemy)
  - OCR-модуль (Tesseract + многопоточность)
- **Технологии**: PyQt6, SQLAlchemy, PIL, pytesseract, SQLite (можно также Postrgesql)

---

## Иерархия классов

- **GUI**:
  - `PaintApp` — основа
  - `Canvas`, `FixedGraphicsScene`, `CustomGraphicsView` — рендеринг и вывод
- **БД**:
  - `User`, `Work` — модели SQLAlchemy
- **Авторизация**:
  - `Login`, `Register` — диалоги по базе данных (`QDialog`)
- **OCR**:
  - `OCRThread` — фоновый поток (`QThread`)

---

## Модель `User`

**Таблица**: `users`

| Поле | Тип | Описание |
|------|-----|---------|
| `id` | INTEGER | Первичный ключ |
| `name` | VARCHAR(50) | Уникальное имя |
| `name_normalized` | VARCHAR(50) | Нижний регистр для поиска |
| `email` | VARCHAR(100) | Уникальный email |
| `password` | VARCHAR(30) | Хэш пароля |

**Валидации**:
- Email — почти формат почты
- Имя — не начинается с цифры/символа
- Пароль — ≥8 символов

---

## Модель `Work`

**Таблица**: `works`

| Поле | Тип | Описание |
|------|-----|---------|
| `id` | INTEGER | Первичный ключ |
| `name` | VARCHAR(50) | Название работы |
| `name_normalized` | VARCHAR(50) | Для поиска |
| `description` | TEXT | Описание |
| `creator_id` | INTEGER | FK → `users.id` |
| `created_at` | DATETIME | Время создания |
| `image_data` | LargeBinary | Изображение в байтах |
| `image_filename` | VARCHAR(255) | Оригинальное имя файла |

**Связь**: Один пользователь → много работ (1:n)

---

## Работа с изображениями

- Загрузка: `QFileDialog` → PIL → `QPixmap`
- Редактирование:
  - Кисть (цвет, толщина)
  - Фильтры: размытие, контраст, каналы (RGB)
- Сохранение:
  - На диск (PNG/JPG)
  - В БД как `LargeBinary`
- Поддержка отмены действий (undo/redo — опционально)

---

## Модуль ОКР

- **Класс**: `OCRThread` (наследует `QThread`)
- **Библиотека**: `pytesseract`
- **Потокобезопасность**: сигналы/слоты PyQt
- **Интеграция**:
  - Пользователь вызывает метод получения еткста → отправка в поток → результат в текстовое поле (можно скачать, текст лишь печатный)
- Обработка ошибок: отсутствие Tesseract, пустое изображение

---

> Архитектура масштабируема и поддерживает расширение функционала (слои, экспорт в PDF, облако и др.)
> Архитектура также обладает повышенной безопасностью от SQL-инъекций
